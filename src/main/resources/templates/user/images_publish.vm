<!DOCTYPE html>

<script type="text/javascript" charset="utf-8" src="/plugins/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/plugins/ueditor/ueditor.all.js"> </script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="/plugins/ueditor/lang/zh-cn/zh-cn.js"></script>
<!--全局公用样式-->
<link rel="stylesheet" type="text/css" href="/plugins/diyUpload/css/globle.css" />

<link rel="stylesheet" href="/user/css/main-default.css" />

#parse("/module/base.vm")

<div class="container b-header__box b-relative">
    <div class="b-header-r b-right b-header-r--icon"></div>
</div>

<div id="wrapper" style:"background-color:>
<!-- Main -->
<div id="main">
    <div class="l-inner-page-container">
        <div class="container">
            <div class="row">
                <div class="col-md-9 col-md-push-3">

                    <div class="b-blog-listing__block">
                        <br><br><br>
                        <form class="form-horizontal" enctype="multipart/form-data" id="images" method="post">

                            <div class="form-group">
                                <label class="col-sm-2 control-label"><h4>宝宝</h4></label>

                                <div class="col-sm-8">
                                    <input  name="title" type="text" class="form-control" >
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label"><h4>相片</h4></label>
                                <div class="col-sm-10">
                                    <div>
                                        <ul class="upload-ul clearfix">
                                            <li class="upload-pick">
                                                <div class="webuploader-container clearfix" id="j_upload_img_btn"></div>
                                            </li>
                                        </ul>
                                    </div>
                                    <ul id="upload_img_wrap"></ul>
                                    <!-- 加载编辑器的容器 -->
                                    <textarea id="uploadEditor" style="display: none;"></textarea>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="col-lg-2 control-label"></label>
                                <div class="col-lg-10">
                                    <button id="articlepublish" type="submit" class="btn btn-primary" onclick="images_publish()">保存</button>
                                </div>

                            </div>
                        </form>
                    </div>
                </div>
                <div class="visible-xs-block visible-sm-block b-hr"></div>
                #include("/module/userbase.vm")
            </div>
        </div>
    </div>
</div>
<script src="/plugins/diyUpload/js/webuploader.min.js"></script>
<script src="/plugins/diyUpload/js/diyUpload.js"></script>
<script>

    var tgaUpload;
    $(function(){
        //上传图片
        tgaUpload = $('#imagefiles').diyUpload({
            url:'/user/images/save',
            success:function( data ) {
                alert(JSON.stringify(data));
            },
            error:function( err ) {
               <!-- alert(err)-->
            },
            buttonText : '',
            accept: {
                title: "Images",
                extensions: 'gif,jpg,jpeg,bmp,png'
            },
            thumb:{
                width:120,
                height:90,
                quality:100,
                allowMagnify:true,
                crop:true,
                type:"image/jpeg"
            }
        });
    });

    function images_publish () {
        tgaUpload.upload();
        var form = new FormData(document.getElementById("images"));
        $.ajax({
            url:"/user/images/save",
            type:"post",
            data:form,
            processData:false,
            contentType:false,
            async:false,
            success:function(data){
                alert(data);
            },
            error:function(e){
                alert("错误！！");
            }
        });
    }
</script>


<!-- 使用ue -->
<script type="text/javascript">

    // 实例化编辑器，这里注意配置项隐藏编辑器并禁用默认的基础功能。
    var uploadEditor = UE.getEditor("uploadEditor", {
        isShow: false,
        focus: false,
        enableAutoSave: false,
        autoSyncData: false,
        autoFloatEnabled:false,
        wordCount: false,
        sourceEditor: null,
        scaleEnabled:true,
        toolbars: [["insertimage", "attachment"]]
    });

    // 监听多图上传和上传附件组件的插入动作
    uploadEditor.ready(function () {
        uploadEditor.addListener("beforeInsertImage", _beforeInsertImage);
        uploadEditor.addListener("afterUpfile",_afterUpfile);
    });

    // 自定义按钮绑定触发多图上传和上传附件对话框事件
    document.getElementById('j_upload_img_btn').onclick = function () {
        var dialog = uploadEditor.getDialog("insertimage");
        dialog.title = '多图上传';
        dialog.render();
        dialog.open();
    };

    document.getElementById('j_upload_file_btn').onclick = function () {
        var dialog = uploadEditor.getDialog("attachment");
        dialog.title = '附件上传';
        dialog.render();
        dialog.open();
    };

    // 多图上传动作
    function _beforeInsertImage(t, result) {
        var imageHtml = '';
        for(var i in result){
            alert(result[i].src);
            imageHtml += '<li><img src="'+result[i].src+'" alt="'+result[i].alt+'" height="150"></li>';
        }
        document.getElementById('upload_img_wrap').innerHTML = imageHtml;
    }

    // 附件上传
    function _afterUpfile(t, result) {
        var fileHtml = '';
        for(var i in result){
            alert(result[i]);
            fileHtml += '<li><a href="'+result[i].url+'" target="_blank">'+result[i].url+'</a></li>';
        }
        document.getElementById('upload_file_wrap').innerHTML = fileHtml;
    }
</script>

</body>

</html>
